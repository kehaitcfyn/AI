# ============================================================
# NGINX Proxy Manager - Advanced Configuration
# ============================================================
# 
# SÅDAN BRUGER DU DENNE FIL:
# 
# 1. Gå til NGINX Proxy Manager (port 81)
# 2. Proxy Hosts → Klik på din host (xxxxx)
# 3. Klik "Edit" → Gå til "Advanced" tab
# 4. Kopier HELE indholdet nedenfor ind i "Custom Nginx Configuration"
# 5. Klik "Save"
# Husk at skifte "Internal-Secret" samt  " proxy_pass" med din gene data
#
# ============================================================


# ------------------------------
# Security Headers
# ------------------------------
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;


# ------------------------------
# API: Auth Endpoints (LOGIN, LOGOUT, etc.)
# ------------------------------
location /api/auth/ {
    proxy_set_header X-Internal-Secret "Din egen Secret";
    
    proxy_pass http://DinegenDocker:8000/auth/;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Connection "";
    
    proxy_connect_timeout 10s;
    proxy_send_timeout 30s;
    proxy_read_timeout 30s;
}


# ------------------------------
# API: Chat Endpoint
# ------------------------------
location = /api/chat {
    proxy_set_header X-Internal-Secret "Din egen Secret";
    
    proxy_pass http://DinegenDocker:8000/chat;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Connection "";
    
    proxy_connect_timeout 30s;
    proxy_send_timeout 120s;
    proxy_read_timeout 120s;
    
    proxy_buffering on;
    proxy_buffer_size 8k;
    proxy_buffers 16 8k;
}


# ------------------------------
# API: Prompts Endpoint
# ------------------------------
location = /api/prompts {
    proxy_set_header X-Internal-Secret "Din egen Secret";
    
    proxy_pass http://DinegenDocker:8000/prompts;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Connection "";
    
    proxy_connect_timeout 10s;
    proxy_send_timeout 30s;
    proxy_read_timeout 30s;
}


# ------------------------------
# API: Collections Endpoint
# ------------------------------
location = /api/collections {
    proxy_set_header X-Internal-Secret "Din egen Secret";
    
    proxy_pass http://DinegenDocker:8000/collections;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Connection "";
    
    proxy_connect_timeout 10s;
    proxy_send_timeout 30s;
    proxy_read_timeout 30s;
}


# ------------------------------
# API: Health Endpoints
# ------------------------------
location ~ ^/api/health(/.*)?$ {
    proxy_set_header X-Internal-Secret "Din egen Secret";
    
    proxy_pass http://DinegenDocker:8000/health$1;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Connection "";
    
    proxy_connect_timeout 5s;
    proxy_send_timeout 10s;
    proxy_read_timeout 10s;
}


# ------------------------------
# API: History Endpoint
# ------------------------------
location ~ ^/api/history/([a-zA-Z0-9\-]+)$ {
    proxy_set_header X-Internal-Secret "Din egen Secret";
    
    proxy_pass http://DinegenDocker:8000/history/$1;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Connection "";
    
    proxy_connect_timeout 10s;
    proxy_send_timeout 30s;
    proxy_read_timeout 30s;
}


# ------------------------------
# API: Reset Endpoint
# ------------------------------
location ~ ^/api/reset/([a-zA-Z0-9\-]+)$ {
    proxy_set_header X-Internal-Secret "Din egen Secret";
    
    proxy_pass http://DinegenDocker:8000/reset/$1$is_args$args;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Connection "";
    
    proxy_connect_timeout 10s;
    proxy_send_timeout 30s;
    proxy_read_timeout 30s;
}


# ------------------------------
# API: Documentation
# ------------------------------
location = /api/docs {
    proxy_set_header X-Internal-Secret "Din egen Secret";
    
    proxy_pass http://DinegenDocker:8000/docs;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

location = /api/redoc {
    proxy_set_header X-Internal-Secret "Din egen Secret";
    
    proxy_pass http://DinegenDocker:8000/redoc;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

location = /api/openapi.json {
    proxy_set_header X-Internal-Secret "Din egen Secret";
    
    proxy_pass http://DinegenDocker:8000/openapi.json;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}


# ------------------------------
# Bloker ukendte API endpoints
# ------------------------------
location /api/ {
    return 404 '{"error": "Endpoint not found"}';
    default_type application/json;
}


# ------------------------------
# Bloker mistænkelige requests
# ------------------------------
location ~* \.(php|asp|aspx|jsp|cgi)$ {
    return 403;
}

location ~ /\.(env|git|svn|htaccess) {
    return 403;
}

location ~* (wp-admin|wp-login|wp-content|xmlrpc) {
    return 403;
}
