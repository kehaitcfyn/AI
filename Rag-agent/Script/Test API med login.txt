# Session til cookies
$session = New-Object Microsoft.PowerShell.Commands.WebRequestSession

# Login
$login = Invoke-RestMethod -Uri "https://DinUrl.dk/api/auth/login" `
    -Method POST -ContentType "application/x-www-form-urlencoded" `
    -Body "username=xxxx&password=xxxxx" `
    -SessionVariable session

# Hent CSRF token
$csrfToken = ($session.Cookies.GetCookies("https://DinUrl.dk") | 
    Where-Object { $_.Name -eq "csrf_token" }).Value

# Headers med Auth + CSRF
$headers = @{ 
    "Authorization" = "Bearer $($login.access_token)"
    "X-CSRF-Token" = $csrfToken
}

# Request med session
$response = Invoke-RestMethod -Uri "https://DinUrl.dk/api/chat" `
    -Method POST -ContentType "application/json" `
    -Headers $headers -WebSession $session `
    -Body '{"message":"test","prompt_key":"3"}'

$response.sources_metadata



####  OUTPUT

rank            : 1
collection      : it_servicedesk
document        : support-it-2026.pdf
page            : 1
sourceUrl       : https://server.dk/files/support-it-2026.pdf
relevance_score : 0,5091
chunk_preview   : [Side 1]
                  Almindelige IT-problemer og lÃ¸sninger for IT-supportere  
                  1. Computer starter ikke 
                  Fejl: Computeren reagerer slet ikke nÃ¥r der trykkes pÃ¥ tÃ¦...

rank            : 2
collection      : it_servicedesk
document        : support-it-2026.pdf
page            : 3
sourceUrl       : https://server.dk/files/support-it-2026.pdf
relevance_score : 0,5091
chunk_preview   : [Side 3]
                  â¢ Scan harddisken med CHKDSK  
                  â¢ Opdater Windows og alle drivere  
                  â¢ Tjek for overheding  
                  â¢ Afinstaller nyligt installeret software  